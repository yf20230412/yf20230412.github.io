# å½±è§†å†…ç½®æ‰“åŒ…ä¿®æ”¹

### ä¸€ã€ä¸‹è½½FongMiç‰ˆä»“åº“
```
https://github.com/FongMi/TV
```
é¦–å…ˆä¿®æ”¹gradle/wrapper/gradle-wrapper.propertiesï¼Œç”¨äºŽåŠ é€Ÿgradleçš„ä¸‹è½½ï¼š
å°†æºä»£ç 
```
distributionUrl=https\://services.gradle.org/distributions/gradle-7.4.2-bin.zip
```
æ”¹æˆ
```
distributionUrl=https\://mirrors.cloud.tencent.com/gradle/gradle-8.8-all.zip
```
---

### äºŒã€ä¸‹è½½JDK17

å»ºè®®ä¸‹è½½amazon-correttoç‰ˆæœ¬

```
https://corretto.aws/downloads/resources/17.0.9.8.1/amazon-corretto-17.0.9.8.1-windows-x64-jdk.zip
```

---

### ä¸‰ã€ è§£å†³åŠ é€ŸåŠä¾èµ–é—®é¢˜(ç§‘å­¦ä¸Šç½‘å¿½ç•¥)

åœ¨åŒæ­¥çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‡ºçŽ°ä¸‹è½½ä¾èµ–æ…¢ï¼ŒæŸäº›åŒ…ä¸‹è½½ä¸äº†ç­‰é—®é¢˜ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š
 â˜…â˜…é¡¹ç›®æ ¹ç›®å½•ä¸‹ã€Šsetting.gradleã€‹æ–‡ä»¶ä¸­â˜…â˜…ï¼Œæ·»åŠ aliyunçš„é•œåƒï¼Œæ”¾åœ¨å‰é¢ï¼Œ

```java
	//æ”¹ä¸ºé˜¿é‡Œäº‘çš„é•œåƒåœ°å€
	maven { setUrl("https://maven.aliyun.com/repository/central") }
	maven { setUrl("https://maven.aliyun.com/repository/jcenter") }
	maven { setUrl("https://maven.aliyun.com/repository/google") }
	maven { setUrl("https://maven.aliyun.com/repository/gradle-plugin") }
	maven { setUrl("https://maven.aliyun.com/repository/public") }
```

æ”¹åŽæ•ˆæžœå¦‚ä¸‹ï¼š
```java
pluginManagement {
    repositories {
	//æ”¹ä¸ºé˜¿é‡Œäº‘çš„é•œåƒåœ°å€
	maven { setUrl("https://maven.aliyun.com/repository/central") }
	maven { setUrl("https://maven.aliyun.com/repository/jcenter") }
	maven { setUrl("https://maven.aliyun.com/repository/google") }
	maven { setUrl("https://maven.aliyun.com/repository/gradle-plugin") }
	maven { setUrl("https://maven.aliyun.com/repository/public") }
        gradlePluginPortal()
        mavenCentral()
        jcenter()
        google()
    }
}
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
	//æ”¹ä¸ºé˜¿é‡Œäº‘çš„é•œåƒåœ°å€
	maven { setUrl("https://maven.aliyun.com/repository/central") }
	maven { setUrl("https://maven.aliyun.com/repository/jcenter") }
	maven { setUrl("https://maven.aliyun.com/repository/google") }
	maven { setUrl("https://maven.aliyun.com/repository/gradle-plugin") }
	maven { setUrl("https://maven.aliyun.com/repository/public") }	
        mavenCentral()
        jcenter()
        google()
        flatDir {
            dirs "$rootDir/app/libs"
        }
        maven {
            url "https://jitpack.io"
        }
        maven {
            url "http://4thline.org/m2"
            allowInsecureProtocol = true
        }
    }
}
include ':app'
include ':hook'
include ':tvbus'
include ':catvod'
include ':quickjs'
include ':thunder'
include ':jianpian'
include ':forcetech'
include ':ijkplayer'
rootProject.name = "TV"
```

---

### å››ã€å†…ç½®æŽ¥å£

å†…ç½®è·¯å¾„ï¼š /app/src/main/java/com/fongmi/android/tv/api/config/VodConfig.java


åŽŸç¬¬136è¡Œï¼šOKèœ‚èœœæºä»£ç å¦‚ä¸‹ï¼š
```java
    private void loadConfigCache(Callback callback) {
        if (!TextUtils.isEmpty(config.getJson()) && config.isCache()) checkJson(Json.parse(config.getJson()).getAsJsonObject(), callback);
        else loadConfig(callback);
    }
```
æ›¿æ¢æˆå¦‚ä¸‹ä»£ç ï¼š

**åœ¨æ­¤ä¹‹å‰è¯·å°†88è¡Œä¸­çš„**
```java
this.loadLive = false;
```
æ”¹æˆ
```java
this.loadLive = true;
```
**è¿™æ ·ç›´æ’­æŽ¥å£å°±å¯ä»¥å’Œç‚¹æ’­æŽ¥å£åŒæ­¥åŠ è½½ï¼Œåä¹‹ä¸åŒæ­¥ã€‚æ ¹æ®è‡ªå·±å–œæ¬¢é€‰æ‹©æ›´æ”¹**
```java
private void loadConfigCache(Callback callback) {
        String url = config.getUrl();
        if (!TextUtils.isEmpty(url)) {
            // å¦‚æžœæœ‰é…ç½®çš„ URLï¼Œå°è¯•ä»Žè¯¥ URL åŠ è½½é…ç½®
            loadConfigFromUrl(url, callback);
        } else {
            // å¦‚æžœæ²¡æœ‰é…ç½®çš„ URLï¼Œä½¿ç”¨é»˜è®¤ URL åŠ è½½é…ç½®
            loadConfigFromDefaultUrl(callback);
        }
    }

    private void loadConfigFromUrl(String url, Callback callback) {
        try {
            String json = Decoder.getJson(url); // å‡è®¾ Decoder.getJson æ˜¯ä»Ž URL èŽ·å– JSON å­—ç¬¦ä¸²çš„æ–¹æ³•
            if (!TextUtils.isEmpty(json)) {
                // å¦‚æžœæˆåŠŸèŽ·å– JSON å­—ç¬¦ä¸²ï¼Œè§£æž JSON å¹¶è°ƒç”¨å›žè°ƒ
                JsonObject jsonObject = Json.parse(json).getAsJsonObject();
                checkJson(jsonObject, callback);
            } else {
                // å¦‚æžœèŽ·å–çš„ JSON å­—ç¬¦ä¸²ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤ URL é‡æ–°åŠ è½½
                loadConfigFromDefaultUrl(callback);
            }
        } catch (Exception e) {
            // ç½‘ç»œè¯·æ±‚å¼‚å¸¸å¤„ç†
            e.printStackTrace();
            // å¦‚æžœè¯·æ±‚å¼‚å¸¸ï¼Œä½¿ç”¨é»˜è®¤ URL é‡æ–°åŠ è½½
            loadConfigFromDefaultUrl(callback);
        }
    }

    private void loadConfigFromDefaultUrl(Callback callback) {
        String defaultUrl = "æ­¤å¤„å¡«å…¥ä½ çš„æŽ¥å£åœ°å€";
        try {
            String json = Decoder.getJson(defaultUrl);
            if (!TextUtils.isEmpty(json)) {
                JsonObject jsonObject = Json.parse(json).getAsJsonObject();
                checkJson(jsonObject, callback);
                Config.find(defaultUrl, 0).name("å…¬ä¼—å·ðŸŽï¼šé£Žè¨€é”‹è¯­88").update();
            } else {
                // å¦‚æžœé»˜è®¤ URL åŠ è½½çš„ JSON å­—ç¬¦ä¸²ä¸ºç©ºï¼Œè°ƒç”¨å›žè°ƒçš„é”™è¯¯æ–¹æ³•
                App.post(() -> callback.error("å¾®ä¿¡å…¬ä¼—å·ðŸŽã€Šé£Žè¨€é”‹è¯­88ã€‹"));
            }
        } catch (Exception e) {
            // é»˜è®¤ URL è¯·æ±‚å¼‚å¸¸å¤„ç†
            e.printStackTrace();
            App.post(() -> callback.error("åŠ è½½é…ç½®å¤±è´¥ï¼š" + e.getMessage()));
        }
    }

```

---

å…¶å®žåˆ°è¿™é‡Œå¯ä»¥è¯´å·²ç»æˆåŠŸäº†ï¼Œä»¥ä¸‹åªæ˜¯ä¼˜åŒ–é¿å…æŽ¥å£æš´éœ²


### mobileç‰ˆä¿®æ”¹

#### 1.  éšè—æŽ¥å£åœ°å€

* mobileä»£ç è·¯å¾„ï¼š

    app/src/mobile/java/com/fongmi/android/tv/ui/dialog/ConfigDialog.java  

ç¬¬68é‡Œçš„initViewæ–¹æ³•ã€‚
```java
private void initView() {
        // è¿™é‡Œåˆ¤æ–­æœ‰åå­—å°±ä¸ä¼šå†™åˆ°è®¾ç½®æ¡†é‡Œï¼Œä¾‹å¦‚åå­—æ˜¯ï¼šæºå·²å†…ç½®
        if (TextUtils.isEmpty(getConfig().getName())) {
            binding.url.setText(ori = getConfig().getUrl());
        }
        binding.input.setVisibility(edit ? View.VISIBLE : View.GONE);
        binding.url.setSelection(TextUtils.isEmpty(ori) ? 0 : ori.length());
    }
```

#### 2. ä¿®æ”¹è®¾ç½®å¼¹æ¡†é‡Œçš„åˆå§‹åŒ–é€»è¾‘ï¼Œå°†è®¾ç½®æ¡†å†…å®¹æ”¹æˆç©ºæ—¶ï¼Œé‡æ–°è¯»å–å†…ç½®æºã€‚

* mobileä»£ç è·¯å¾„

    app/src/mobile/java/com/fongmi/android/tv/ui/dialog/ConfigDialog.java 

ç¬¬126è¡Œé‡Œçš„onPositiveæ–¹æ³•ã€‚
```java
private void onPositive(DialogInterface dialog, int which) {
        String url = binding.url.getText().toString().trim();
        String name = binding.name.getText().toString().trim();
        if (edit) Config.find(ori, type).url(url).name(name).update();
        if (url.isEmpty()) {
            // æœªå¡«å†™æ—¶ï¼Œç‚¹äº†ç¡®å®šï¼Œæ”¹æˆå†…ç½®æº
            url = "æ­¤å¤„å¡«å…¥ä½ çš„æŽ¥å£åœ°å€";
            Config.find(url, 1).name("å…¬ä¼—å·ï¼šé£Žè¨€é”‹è¯­88").update();
            //Config.delete(ori, type);
        }
        callback.setConfig(Config.find(url, type));
        dialog.dismiss();
    }
```
---

 ### leanbackç‰ˆä¿®æ”¹

#### 1.  éšè—æŽ¥å£åœ°å€
* leanbackä»£ç è·¯å¾„ï¼šapp/src/leanback/java/com/fongmi/android/tv/ui/dialog/ConfigDialog.java

ç¬¬82è¡Œé‡Œçš„initViewæ–¹æ³•ã€‚
leanbackç‰ˆæœ¬ï¼Œé™¤äº†ä¿®æ”¹ä¸€ç‚¹ä»£ç å¤–ï¼Œè¿˜éœ€æ–°å¢žä¸€ä¸ªgetNameæ–¹æ³•ï¼Œæ‰‹åŠ¨æ”¹ä¸€ä¸‹å³å¯ï¼š
```java
private void initView() {
        String address = Server.get().getAddress();
        //  binding.text.setText(url = getUrl());
        // è¿™é‡Œåˆ¤æ–­æœ‰åå­—å°±ä¸ä¼šå†™åˆ°è®¾ç½®æ¡†é‡Œï¼Œä¾‹å¦‚åå­—æ˜¯ï¼šæºå·²å†…ç½®
        if (TextUtils.isEmpty(getName())) {
            binding.text.setText(url = getUrl());
        }
        binding.code.setImageBitmap(QRCode.getBitmap(Server.get().getAddress(3), 200, 0));
        binding.info.setText(ResUtil.getString(R.string.push_info, Server.get().getAddress()).replace("ï¼Œ", "\n"));
        binding.storage.setVisibility(PermissionX.isGranted(activity, Manifest.permission.WRITE_EXTERNAL_STORAGE) ? View.GONE : View.VISIBLE);
    }
    private String getName() {
        switch (type) {
            case 0:
                return VodConfig.get().getConfig().getName();
            case 1:
                return LiveConfig.get().getConfig().getName();
            case 2:
                return WallConfig.get().getConfig().getName();
            default:
                return "";
        }
    }
```
#### 2. ä¿®æ”¹è®¾ç½®å¼¹æ¡†é‡Œçš„åˆå§‹åŒ–é€»è¾‘ï¼Œå°†è®¾ç½®æ¡†å†…å®¹æ”¹æˆç©ºæ—¶ï¼Œé‡æ–°è¯»å–å†…ç½®æºã€‚

* leanbackä»£ç è·¯å¾„ï¼šapp/src/leanback/java/com/fongmi/android/tv/ui/dialog/ConfigDialog.java

 ç¬¬157è¡Œé‡Œçš„onPositiveæ–¹æ³•ã€‚
```java
private void onPositive(View view) {
        String text = binding.text.getText().toString().trim();
        if (edit) Config.find(url, type).url(text).update();
    //  if (text.isEmpty()) Config.delete(url, type);
        if (text.isEmpty()) {
            url = "https://www.gitlink.org.cn/api/yf1688/box/raw/GL22.json?ref=master";
            Config.find(url, 1).name("å…¬ä¼—å·ï¼šé£Žè¨€é”‹è¯­88").update();
            //Config.delete(ori, type);
        }
        callback.setConfig(Config.find(text, type));
        dialog.dismiss();
    }
```

---

### äº”ã€ä»“åº“è‡ªåŠ¨å‡çº§

è·¯å¾„ï¼šcatvod/src/main/java/com/github/catvod/utils/Github.java

å°†ç¬¬11è¡Œ
```
public static final String URL = "https://my.t4tv.hz.cz";
```
æ”¹æˆ
```
"ä½ çš„åŸŸå/Release";
```

### å…­ã€æ‰“åŒ…

æ‰“åŒ…apkæå–è·¯å¾„ï¼šTV/app


### ä¸ƒã€ä¸Šä¼ apkè½¯ä»¶åˆ°è‡ªå·±çš„ä»“åº“

**ä»“åº“è·¯å¾„è®¾ç½®ï¼š**
  å¿…é¡»åœ¨æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª`Release`æ–‡ä»¶å¤¹ï¼Œç„¶åŽåœ¨`Release`ç›®å½•ä¸­æ–°å»ºä¸€ä¸ª`apk`æ–‡ä»¶å¤¹ï¼Œç„¶åŽåœ¨`apk`æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ª`release`æ–‡ä»¶å¤¹ã€`kitkat`æ–‡ä»¶å¤¹ï¼Œ`dev`æ–‡ä»¶å¤¹ï¼Œè¿™ä¸‰ä¸ªæ–‡ä»¶å¤¹åˆ†åˆ«ä»£è¡¨`æ­£å¼ç‰ˆ`ã€`å®‰å“4ç‰ˆ`ã€`æµ‹è¯•ç‰ˆ`ã€‚åœ¨è¿™ä¸‰ä¸ªæ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ª`mobile.json`æ–‡ä»¶å’Œä¸€ä¸ª`leanback.json`æ–‡ä»¶ã€‚

æ–‡ä»¶å¡«å…¥å¦‚ä¸‹å†…å®¹ï¼š
```js
{
  "code": 253, //ç‰ˆæœ¬å·
  "name": "2.5.3", //ç‰ˆæœ¬å·
  "desc": "æ­¤å¤„å¡«å†™å‡çº§å†…å®¹"
}
```

> [!TIP]è·¯å¾„æ ¼å¼
>ä½ çš„åŸŸååœ°å€ï¼š/Release/apk/release/mobile-python-arm64_v8a.apk
>ä½ çš„åŸŸååœ°å€ï¼š/Release/apk/release/leanback-python-armeabi_v7a.apk

> [!IMPORTANT]æ³¨æ„
>è½¯ä»¶åä¸èƒ½æ›´æ”¹æ‰‹æœºä¸º`mobile-python-arm64_v8a.apk` ï¼ŒTVç‰ˆä¸º`leanback-python-armeabi_v7a.apk`
>è½¯ä»¶ä¸Šä¼ è·¯å¾„ä¸º`release`æˆ–`kitkat`æˆ–`dev`æ–‡ä»¶å¤¹ã€‚

---

<LastUpdated />
<confetti />
