# 新建 `newxd` 类名及调用方法说明


## 🧩 一、新建 `newxd` 类名

###  搜索与定位

#### 1. **搜索关键词**：
   - 在代码编辑器中搜索 `扫码远程推送`。
   - 搜索类型选择 `代码`。

#### 2. **继续查找点击监听器**：
   - 再次搜索 `setOnClickListener`。
   - 选择距离 `扫码远程推送` 最近的一个匹配项（通常是第三个）。

#### 3. **跳转到类并复制代码**：
   - 双击 `Lcom/androidx/xd;-><init>` 跳转到 `xd` 类。
   - 全选并复制该类代码。

#### 4. **重命名类**：
   - 点击页面左上角的 `xd`。
   - 点击“定位”。
   - 长按 `xd`，选择“添加类名”，输入新类名 `newxd`。
   - 进入 `newxd` 类并粘贴之前复制的代码。

---

### 代码修改与优化

#### 1. 替换类名
- 将所有 `xd` 替换为 `newxd`。

#### 2. 删除无用代码段：

| 行号 | 原始代码 |
|------|----------|
| 第8行 | `.implements Landroid/view/View$OnClickListener;` |
| 第10行 | `.field public final synthetic a:I` |

#### 3. 修改方法名与参数：

- 原：`.method public synthetic constructor <init>(Ljava/lang/Object;I)V`
- 去掉`I`改为：`.method public synthetic constructor <init>(Ljava/lang/Object;)V`

#### 4. 删除寄存器参数 `I` 相关内容
- 删除第22行：`iput p2, p0, Lcom/androidx/newxd;->a:I`

#### 5. 修改 `onClick` 方法为 `autoupdate()`并去掉括号内所有内容：

- 原：`.method public final onClick(Landroid/view/View;)V`
- 改为：`.method public final autoupdate()V`

#### 6. 删除以下内容：

- 删除 `const-string v3, "this$0"` 及其上方所有代码。
- 删除 `packed-switch v0, :pswitch_data_11a` 区域。
- 保留 `iget-object v4, p0, Lcom/androidx/xd;->b:Ljava/lang/Object;`
- 删除从 `check-cast v4, Lcom/github/tvbox/osc/ui/view/PlayerMoreFucPop;` 到第一个 `new-instance v1, Lcom/androidx/ek0;` **中间**的所有代码。
- 删除 `:goto_8c` 标签及其后的内容，保留 `return-void`。

- 紧接着删除  `return-void`后面一直到最后面`.end method` **中间**全部代码

#### 7. 替换 `check-cast` 中的目标类

- 根据最后面倒数第三行`handleRemotePush`中的` Lcom/androidx/tt0`;

```smali
invoke-virtual {v4, v1}, Lcom/androidx/tt0;->handleRemotePush(Lcom/androidx/ek0;)V " 
```
将 `check-cast v4, Lcom/github/tvbox/osc/ui/view/PlayerMoreFucPop;` 替换为：
  
```smali
check-cast v4, Lcom/androidx/tt0;
```

---

### 8. 添加自定义接口逻辑

在 `.method public final autoupdate()V` 下方添加如下代码：

```smali
    const-string/jumbo v3, "接口名称"
    const-string v5, "此处填入多仓接口URL链接"
```

更改下面`v0`和`p1` 寄存器和上面的`v3`和`v5`一一对应，更改后的效果：

```
    invoke-virtual {v2, v3}, Lcom/github/tvbox/osc/bean/MoreSourceBean;->setSourceName(Ljava/lang/String;)V

    .line 133
    invoke-virtual {v2, v5}, Lcom/github/tvbox/osc/bean/MoreSourceBean;->setSourceUrl(Ljava/lang/String;)V
```
::: danger ⚠️注意事项
`v3`和`v5` 可以随意改动，但不能用已经被使用过的寄存器，所以需要点击上面的`铅笔`图标，点击`寄存器分析`，查看所有可用的寄存器。根据当前方法使用的寄存器情况，选择未被占用的寄存器（如 `v3` 和 `v5`），必要时可调整 `.registers` 数量。
:::

最后点击`转成Java`查看是否报错，如有错误请修正后重新加载。

💡  **新建 `newxd` 类完成**


## ✂️ 二、调用 `newxd` 类的方法

---

### ✅ 方法一：通过 `HomeActivity` 调用

#### 步骤：

1. 在 **classes** 文件中搜索 `HomeActivity`。
2. 导航至 `init()V` 方法（通常位于 `finish()V` 和 `onBackPressed()V` 之间）。
3. 在 `init()` 方法前插入 **代码①**，在方法体内插入 **代码②**，效果如下所示：

```smali
在此处插入代码①
.method public final init()V
    .registers 11

    在此处插入代码②

    .line 1
    invoke-static {}, Lcom/androidx/jj;->u()Lcom/androidx/jj;

    .line 4
    move-result-object v0
```

#### 🌺代码①：新增方法 `checkCSPJarFileExistence`

```smali
.method private checkCSPJarFileExistence()V
    .registers 5
    
    invoke-virtual {p0}, Lcom/github/tvbox/osc/ui/activity/HomeActivity;->getFilesDir()Ljava/io/File;

    move-result-object v0

    new-instance v1, Ljava/io/File;

    const-string v2, "csp.jar"

    invoke-direct {v1, v0, v2}, Ljava/io/File;-><init>(Ljava/io/File;Ljava/lang/String;)V

    invoke-virtual {v1}, Ljava/io/File;->exists()Z
    
    move-result v3

    if-nez v3, :cond_1e

    new-instance v0, Lcom/androidx/tt0;

    invoke-direct {v0, p0}, Lcom/androidx/tt0;-><init>(Landroid/app/Activity;)V

    new-instance v1, Lcom/androidx/newxd;

    invoke-direct {v1, v0}, Lcom/androidx/newxd;-><init>(Ljava/lang/Object;)V

    invoke-virtual {v1}, Lcom/androidx/newxd;->autoupdate()V

    :cond_1e
    return-void
.end method
```

#### 🌺代码②：在 `init()` 方法内调用

```smali
invoke-direct {p0}, Lcom/github/tvbox/osc/ui/activity/HomeActivity;->checkCSPJarFileExistence()V
```
::: warning ⚠️注意事项：

替换"tt0"和"newxd"，检查"autoupdate"方法名和新建的"newxd"类名中的"autoupdate"是否一致。

::: 

---

### ✅ 方法二：通过 `BaseActivity` 调用

#### 步骤：

1. 根据"newxd"类名中的`tt0`，搜索 `tt0` 类名。
2. 转成 Java 查找 `扫码远程推送` 关键词，找到 `setAdapter` 相关代码。
3. 复制以下两段代码：

```smali
new-instance p1, Lcom/androidx/xd;
```

和

```smali
invoke-direct {p1, p0, v3}, Lcom/androidx/xd;-><init>(Ljava/lang/Object;I)V
```

得到 `代码②`

原代码：
```smali
    nvoke-virtual {p1, v3}, Lcom/owen/tvrecyclerview/widget/TvRecyclerView;->setAdapter(Landroidx/recyclerview/widget/RecyclerView$Adapter;)V

    .line 269
    :goto_10c
    if-eqz v1, :cond_117

    .line 271
    new-instance p1, Lcom/androidx/xd;

    .line 273
    const/4 v3, 0x3

    .line 274
    invoke-direct {p1, p0, v3}, Lcom/androidx/xd;-><init>(Ljava/lang/Object;I)V

    .line 277
    invoke-virtual {v1, p1}, Landroid/view/View;->setOnClickListener(Landroid/view/View$OnClickListener;)V
```
4. 点击导航栏的`init`长按查看调用处，在当前结果中搜索`getTopActivity(...)`：

复制上面的代码
```smali
new-instance p1, Lcom/androidx/tt0;
```

和下面的代码
```smali
invoke-direct {p1, v0}, Lcom/androidx/tt0;-><init>(Landroid/app/Activity;)V
```
得到 `代码①`
原代码如下：
```smali
    if-nez v0, :cond_97

    .line 134
    :cond_85
    new-instance p1, Lcom/androidx/tt0;

    .line 136
    invoke-static {}, Lcom/blankj/utilcode/util/b;->b()Landroid/app/Activity;

    .line 139
    move-result-object v0

    .line 140
    const-string v1, "getTopActivity(...)"

    .line 142
    invoke-static {v0, v1}, Lcom/androidx/xx;->g(Ljava/lang/Object;Ljava/lang/String;)V

    .line 145
    invoke-direct {p1, v0}, Lcom/androidx/tt0;-><init>(Landroid/app/Activity;)V

    .line 148
    invoke-virtual {p1}, Lcom/androidx/tt0;->show()V

    .line 151
    return-void
```

5. 返回 `newxd` 类，导航中长按 `autoupdate`，复制 `复制invoke代码` 得到如下代码：

```smali
invoke-virtual {v0}, Lcom/androidx/newxd;->autoupdate()V
```

6. 搜索 `BaseActivity`，进入 `onCreate` 方法，在其中插入以下代码（顺序：② → ① → ③）：

```smali
new-instance p1, Lcom/androidx/tt0;
invoke-direct {p1, v0}, Lcom/androidx/tt0;-><init>(Landroid/app/Activity;)V

new-instance p1, Lcom/androidx/xd;
invoke-direct {p1, p0, v3}, Lcom/androidx/xd;-><init>(Ljava/lang/Object;I)V

invoke-virtual {v0}, Lcom/androidx/newxd;->autoupdate()V
```

::: danger 注意事项
更改代码: `tt0` 和 `xd`还有`寄存器`以及`(Ljava/lang/Object;I)`里面的 ` I `，寄存器只能用v0、v1、p0替换。
:::

更改后代码如下：

```smali
    new-instance v0, Lcom/androidx/tt0;
    invoke-direct {v0, p0}, Lcom/androidx/tt0;-><init>(Landroid/app/Activity;)V
    new-instance v1, Lcom/androidx/newxd;
    invoke-direct {v1, v0}, Lcom/androidx/newxd;-><init>(Ljava/lang/Object;)V
    invoke-virtual {v0}, Lcom/androidx/newxd;->autoupdate()V
```
转成java代码查看`onCreate`代码最终效果应为：

```java
new newxd(new tt0(this)).autoupdate();
```

**📌 以上是通过`HomeActivity`和`BaseActivity`调用"newxd"的两种方法。**
